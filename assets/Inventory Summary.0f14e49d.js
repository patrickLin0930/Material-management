import{l as U,i as $,v as j,c as E,h as W,m as J,g as X,y as Y,W as Z,r as N,o as G,a5 as l,a6 as P,a7 as o,ak as K,aa as I,j as c,aq as ee,at as O,a9 as B,au as L,ah as m,aj as q,F as k,ai as y,av as D}from"./index.f70666c9.js";import{Q as R,a as S}from"./QItem.e2ac683b.js";import{Q as M}from"./QExpansionItem.ba7b012e.js";import{_ as te}from"./plugin-vue_export-helper.21dcd24c.js";import"./QItemLabel.81a1b2d6.js";var ae=U({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(x,{slots:d}){const{proxy:{$q:b}}=X(),s=$(Y,j);if(s===j)return console.error("QPage needs to be a deep child of QLayout"),j;if($(Z,j)===j)return console.error("QPage needs to be child of QPageContainer"),j;const F=E(()=>{const r=(s.header.space===!0?s.header.size:0)+(s.footer.space===!0?s.footer.size:0);if(typeof x.styleFn=="function"){const t=s.isContainer.value===!0?s.containerHeight.value:b.screen.height;return x.styleFn(r,t)}return{minHeight:s.isContainer.value===!0?s.containerHeight.value-r+"px":b.screen.height===0?r!==0?`calc(100vh - ${r}px)`:"100vh":b.screen.height-r+"px"}}),u=E(()=>`q-page${x.padding===!0?" q-layout-padding":""}`);return()=>W("main",{class:u.value,style:F.value},J(d.default))}});const se={name:"InventorySummary",setup(){const x=N(""),d=N({}),b=["\u5167\u8863","\u5167\u8932","\u5176\u4ED6\u5546\u54C1"],s=async()=>{var T,A;const r=await K.dailyForms.toArray(),t=await K.styles.toArray(),e={};t.forEach(({name:i,color:v,size:g,category:C})=>{const a=C||"\u5176\u4ED6\u5546\u54C1";e[a]||(e[a]={home:{},car:{}}),e[a].home[i]||(e[a].home[i]={}),e[a].car[i]||(e[a].car[i]={}),e[a].home[i][v]||(e[a].home[i][v]={}),e[a].car[i][v]||(e[a].car[i][v]={}),e[a].home[i][v][g]=0,e[a].car[i][v][g]=0}),r.forEach(i=>{i.records.forEach(v=>{const{name:g,color:C,size:a,quantity:f,action:_}=v,w=t.find(z=>z.name===g&&z.color===C&&z.size===a),Q=w&&w.category||"\u5176\u4ED6\u5546\u54C1",p=e[Q].home[g][C],h=e[Q].car[g][C];switch(_){case"\u9032\u8CA8":p[a]+=f;break;case"\u8ECA\u4E2D\u79FB\u81F3\u5BB6\u4E2D":h[a]=Math.max(0,h[a]-f),p[a]+=f;break;case"\u5BB6\u4E2D\u79FB\u81F3\u8ECA\u4E2D":p[a]=Math.max(0,p[a]-f),h[a]+=f;break;case"\u5DF2\u8CE3\u51FA":h[a]=Math.max(0,h[a]-f);break}})});const n={};for(const i of b){const v=Object.entries(((T=e[i])==null?void 0:T.home)||{}).map(([f,_])=>{const w=Object.entries(_).flatMap(([p,h])=>Object.entries(h).map(([z,V])=>({color:p,size:z,quantity:V}))),Q=w.reduce((p,h)=>p+h.quantity,0);return{name:f,items:w,total:Q}}),g=Object.entries(((A=e[i])==null?void 0:A.car)||{}).map(([f,_])=>{const w=Object.entries(_).flatMap(([p,h])=>Object.entries(h).map(([z,V])=>({color:p,size:z,quantity:V}))),Q=w.reduce((p,h)=>p+h.quantity,0);return{name:f,items:w,total:Q}}),C=v.reduce((f,_)=>f+_.total,0),a=g.reduce((f,_)=>f+_.total,0);n[i]={home:v,homeTotal:C,car:g,carTotal:a}}d.value=n},H=E(()=>{var t;const r={};for(const e of b)r[e]=(((t=d.value[e])==null?void 0:t.home)||[]).filter(n=>n.name.includes(x.value));return r}),F=E(()=>{var t;const r={};for(const e of b)r[e]=(((t=d.value[e])==null?void 0:t.car)||[]).filter(n=>n.name.includes(x.value));return r}),u=r=>{const t={};return r.forEach(e=>{t[e.color]||(t[e.color]=[]),t[e.color].push(e)}),Object.entries(t).map(([e,n])=>({color:e,items:n}))};return G(s),{search:x,categories:b,inventory:d,filteredHome:H,filteredCar:F,groupByColor:u}}},re={class:"column q-gutter-md"},oe={class:"text-subtitle1",style:{width:"100%",height:"3vh","padding-top":"0.5vh"}},ne={class:"q-mb-xs",style:{"font-size":"3vw","font-weight":"bold"}},le={class:"text-subtitle1",style:{width:"100%",height:"3vh","padding-top":"0.5vh"}},ce={class:"q-mb-xs",style:{"font-size":"3vw","font-weight":"bold"}};function ie(x,d,b,s,H,F){return l(),P(ae,{class:"font q-pa-md bg-grey-2"},{default:o(()=>[d[3]||(d[3]=I("div",{class:"q-mb-md text-center",style:{height:"4.5vh","font-size":"5vw","font-weight":"bold"}}," \u76EE\u524D\u5EAB\u5B58\u72C0\u6CC1 ",-1)),c(ee,{modelValue:s.search,"onUpdate:modelValue":d[0]||(d[0]=u=>s.search=u),label:"\u641C\u5C0B\u6B3E\u865F",dense:"",debounce:"300",class:"q-mb-md input"},null,8,["modelValue"]),I("div",re,[c(D,{flat:"",bordered:""},{default:o(()=>[c(O,{class:"bg-primary text-white text-center",style:{"font-size":"3vw","font-weight":"bold"}},{default:o(()=>d[1]||(d[1]=[B(" \u5BB6\u4E2D\u5EAB\u5B58 ")])),_:1}),c(L),c(O,null,{default:o(()=>[(l(!0),m(k,null,q(s.categories,u=>{var r;return l(),m("div",{key:u,class:"q-mb-md"},[c(M,{"expand-separator":"",dense:"",label:`\u{1F4E6} \u985E\u5225\uFF1A${u}\uFF08\u5171 ${((r=s.inventory[u])==null?void 0:r.homeTotal)||0} \u4EF6\uFF09`,"header-class":"bg-dark text-white text-weight-bold",style:{"font-size":"3.5vw"}},{default:o(()=>[(l(!0),m(k,null,q(s.filteredHome[u],t=>(l(),m("div",{key:t.name,class:"q-mb-md"},[c(M,{"expand-separator":"",dense:"",class:"content-row"},{header:o(()=>[I("div",oe," \u6B3E\u865F\uFF1A"+y(t.name)+"\uFF08\u5171 "+y(t.total)+" \u4EF6\uFF09 ",1)]),default:o(()=>[(l(!0),m(k,null,q(s.groupByColor(t.items),e=>(l(),m("div",{key:e.color,class:"q-pa-sm q-mb-sm q-gutter-sm",style:{border:"1px solid #ccc","border-radius":"6px",background:"#f0f0f0"}},[I("div",ne," \u984F\u8272\uFF1A"+y(e.color),1),(l(!0),m(k,null,q(e.items,n=>(l(),P(R,{key:n.color+n.size,dense:"",style:{height:"4vh","font-size":"3.5vw"}},{default:o(()=>[c(S,null,{default:o(()=>[B(y(n.size),1)]),_:2},1024),c(S,{side:""},{default:o(()=>[B(y(n.quantity),1)]),_:2},1024)]),_:2},1024))),128))]))),128))]),_:2},1024)]))),128))]),_:2},1032,["label"])])}),128))]),_:1})]),_:1}),c(D,{flat:"",bordered:""},{default:o(()=>[c(O,{class:"bg-teal text-white text-center",style:{"font-size":"3vw","font-weight":"bold"}},{default:o(()=>d[2]||(d[2]=[B(" \u8ECA\u4E2D\u5EAB\u5B58 ")])),_:1}),c(L),c(O,null,{default:o(()=>[(l(!0),m(k,null,q(s.categories,u=>{var r;return l(),m("div",{key:u,class:"q-mb-md"},[c(M,{"expand-separator":"",dense:"",label:`\u{1F4E6} \u985E\u5225\uFF1A${u}\uFF08\u5171 ${((r=s.inventory[u])==null?void 0:r.carTotal)||0} \u4EF6\uFF09`,"header-class":"bg-dark text-white text-weight-bold",style:{"font-size":"3.5vw"}},{default:o(()=>[(l(!0),m(k,null,q(s.filteredCar[u],t=>(l(),m("div",{key:t.name,class:"q-mb-md"},[c(M,{"expand-separator":"",dense:"",class:"content-row"},{header:o(()=>[I("div",le," \u6B3E\u865F\uFF1A"+y(t.name)+"\uFF08\u5171 "+y(t.total)+" \u4EF6\uFF09 ",1)]),default:o(()=>[(l(!0),m(k,null,q(s.groupByColor(t.items),e=>(l(),m("div",{key:e.color,class:"q-pa-sm q-mb-sm q-gutter-sm",style:{border:"1px solid #ccc","border-radius":"6px",background:"#f0f0f0"}},[I("div",ce," \u984F\u8272\uFF1A"+y(e.color),1),(l(!0),m(k,null,q(e.items,n=>(l(),P(R,{key:n.color+n.size,dense:"",style:{height:"4vh","font-size":"3.5vw"}},{default:o(()=>[c(S,null,{default:o(()=>[B(y(n.size),1)]),_:2},1024),c(S,{side:""},{default:o(()=>[B(y(n.quantity),1)]),_:2},1024)]),_:2},1024))),128))]))),128))]),_:2},1024)]))),128))]),_:2},1032,["label"])])}),128))]),_:1})]),_:1})])]),_:1})}var pe=te(se,[["render",ie],["__scopeId","data-v-5a2ba47f"]]);export{pe as default};
